{% extends 'auctions/layout.html' %}

{% block body %}

<div class="listing">
    <h2>{{listing.title}}</h2>
    {% if listing not in request.user.watchlist.all %}
    <form action="{% url 'add-watchlist' listing.id %}" method="POST">
        <button type="submit" class="btn btn-outline-dark">Add to Watchlist</button>
        {% csrf_token %}
    </form>
    {% else %}
    <form action="{% url 'remove-watchlist' listing.id %}" method="POST">
        <button class="btn btn-outline-dark" type="submit">Remove from watchlist</button>
        {% csrf_token %}
    </form>
    {% endif %}
    {% if listing.image %}
    <img src="{{ listing.image }}">
    {% endif %}
    {% if listing.description %}
    <div id="description">
        {{listing.description}}
    </div>
    {% endif %}
    <div id="price">
        Price: ${{listing.price}}
    </div>
    {% if listing.highest_bid %}
    <div id="highest_bid">
        Highest Bid: ${{listing.highest_bid.value}}
    </div>
    <div id="highest_bidder">
        {% if listing.highest_bid.user == request.user %}
        Made By: You
        {% else %}
        Made By: {{listing.highest_bid.user.username}}
        {% endif %}
    </div>
    {% else %}
    <div id="highest_bid">
        No Bids
    </div>
    {% endif %}
    {% if listing.user != request.user %}
    <form action="{% url 'bid' listing.id %}" method="post">
        <input type="number" name="bid" min="{{ listing.highest_bid.value }}" placeholder="Your Bid">
        <button class="btn btn-outline-dark" type="submit">Bid</button>
        {% csrf_token %}
    </form>
    {% endif %}
    <h3>Comments</h3>
    <form action="{% url 'comment' listing.id %}" method="post">
        <input class="form-control mb-2" type="text" name="comment" autocomplete="off" placeholder="Comment">
        <button class="btn btn-outline-dark" type="submit">Comment</button>
        {% csrf_token %}
    </form>
    {% for comment in listing.comments.all %}
    <hr>
    <h4>{{ comment.user.username }}</h4>
    <p>
        {{ comment.comment }}
    </p>
    <div>
        Made on: {{ comment.date }}
    </div>
    {% endfor %}
</div>
{% endblock %}